# 门结构和位置说明

## 🚪 门的整体结构

### 门的组成
每个门由以下4个组件构成：
1. **左立柱** (`left_post`) - 垂直圆柱体
2. **右立柱** (`right_post`) - 垂直圆柱体  
3. **上横梁** (`top_bar`) - 水平圆柱体
4. **下横梁** (`bottom_bar`) - 水平圆柱体

### 门的层次结构
```
Gate_i (Xform 父对象) ← self.gate_positions[env, i] 存储的位置
├── left_post (子对象)
├── right_post (子对象)
├── top_bar (子对象)
└── bottom_bar (子对象)
```

## 📍 `self.gate_positions` 的含义

**`self.gate_positions[env_idx, gate_idx]` 存储的是门的中心点位置**

- **不是** 某个柱子的位置
- **是** 整个门的几何中心点位置
- **是** Xform 父对象的变换位置
- 所有4个组件（柱子和横梁）都相对于这个中心点进行偏移定位

## 🎯 门中心点的坐标系

```
     Z (高度)
     ↑
     |
     |     Y (左右)
     |    ↗
     |   /
     |  /
     | /
     +--------→ X (前进方向)
    门中心点
```

## 📏 各组件相对门中心的位置

### 立柱位置
- **左立柱**: `[0.0, -gate_width/2, 0.0]` (Y轴负方向偏移)
- **右立柱**: `[0.0, +gate_width/2, 0.0]` (Y轴正方向偏移)

### 横梁位置  
- **上横梁**: `[0.0, 0.0, +gate_height/2]` (Z轴正方向偏移)
- **下横梁**: `[0.0, 0.0, -gate_height/2]` (Z轴负方向偏移)

## 🏗️ 门的尺寸参数

- `gate_width`: 门的宽度（Y方向），默认4.0米
- `gate_height`: 门的高度（Z方向），默认3.0米
- `post_radius`: 柱子半径，固定0.1米
- `post_height`: 立柱高度 = `gate_height`

## 🎮 门的运动方式

### 位置运动
1. **X轴**: 固定不动（保持推进顺序）
2. **Y轴**: 正弦波摆动，范围±3米
3. **Z轴**: 余弦波升降，范围1-4米

### 旋转运动
- 绕Z轴（垂直轴）缓慢振荡
- 角度范围：±0.2弧度（约±11.5度）

## 🔄 状态存储格式

```python
# 门状态张量的维度和含义
self.gate_positions[num_envs, gate_count, 3]         # 门中心位置 [X, Y, Z]
self.gate_velocities[num_envs, gate_count, 3]        # 门中心速度 [Vx, Vy, Vz]  
self.gate_rotations[num_envs, gate_count, 4]         # 门旋转四元数 [x, y, z, w]
self.gate_angular_velocities[num_envs, gate_count, 3] # 门角速度 [Wx, Wy, Wz]
```

## 📊 观察信息

门信息在观察中的15维特征：
```python
gate_info = [
    gate_pos[3],     # 门中心位置 (X, Y, Z)
    gate_rot[4],     # 门旋转四元数 (x, y, z, w)  
    gate_vel[3],     # 门中心速度 (Vx, Vy, Vz)
    gate_angvel[3],  # 门角速度 (Wx, Wy, Wz)
    gate_size[2]     # 门尺寸 (宽度, 高度)
]
```

## 🎯 关键理解

1. **`self.gate_positions` = 门的中心点位置**，不是柱子位置
2. **所有组件都相对于门中心定位**，实现统一移动
3. **门作为整体移动和旋转**，保持形状不变
4. **无人机需要穿越的是门中心区域**，避开4个组件
